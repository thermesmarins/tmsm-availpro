jQuery,window.wp;var $,TmsmAvailproApp=TmsmAvailproApp||{};!function(a,t){"use strict";t.animateTransition=function(t){t.show(),a("html, body").animate({scrollTop:t.offset().top},400)},t.init=function(){var t=a("#tmsm-availpro-calendar");if(t.length>0){var e,o,l,r,s,m=moment().subtract(1,"days"),i=moment(),c=moment().add(1,"year"),d=1,n=0,v=function(t){r=t.format("YYYY"),s=t.format("MM");var e=[];if(void 0!==tmsm_availpro_params.data&&void 0!==tmsm_availpro_params.data[t.format("YYYY-MM")]){var o=tmsm_availpro_params.data[t.format("YYYY-MM")],l=[],m=0,i=null;a.each(o,function(a,t){void 0!==t.totalPrice&&"NotAvailable"!==t.Status&&(null===i&&(i=Number(t.totalPrice)),Number(t.totalPrice)<i&&(i=Number(t.totalPrice)))}),a.each(o,function(a,t){t.date=a,void 0!==t.totalPrice&&"NotAvailable"!==t.Status&&(t.PriceWithCurrency=Number(t.totalPrice).toLocaleString(tmsm_availpro_params.locale,{style:"currency",currency:tmsm_availpro_params.options.currency,minimumFractionDigits:0,maximumFractionDigits:2}),t.Test=tmsm_availpro_params.locale,Number(t.totalPrice)===i&&(t.LowestPrice=1),l[m]=t,e.push(l[m]),m++)}),u.addEvents(e)}},p=function(){t.width()>600?(t.addClass("calendar-large"),t.removeClass("calendar-small")):(t.addClass("calendar-small"),t.removeClass("calendar-large"))};a(window).resize(function(){p()}),p();var u=t.clndr({template:a("#tmsm-availpro-calendar-template").html(),startWithMonth:i,constraints:{startDate:m,endDate:c},adjacentDaysChangeMonth:!0,forceSixRows:!1,trackSelectedDate:!1,clickEvents:{click:function(t){var r=!1;a(".day.mouseover").removeClass("mouseover"),!a(t.element).hasClass("inactive")&&!a(t.element).hasClass("last-month")&&!a(t.element).hasClass("next-month")&&((l=t.date,void 0!==e&&e>l?(a(".calendar-day-"+e.format("YYYY-MM-DD")).removeClass("selected").removeClass("selected-hover").removeClass("selected-begin").removeClass("selected-end").removeClass("active"),r=!0,e=void 0,o=void 0):r=!1,void 0!==e&&void 0!==o&&(a(".day").removeClass("selected").removeClass("selected-hover").removeClass("selected-begin").removeClass("selected-end").removeClass("active"),e=void 0,o=void 0,a("#tmsm-availpro-form-checkoutdateinfo").html(""),a("#tmsm-availpro-form-checkoutdate").val("")),void 0===e)?(e=l,a(".calendar-day-"+e.format("YYYY-MM-DD")).addClass("selected selected-begin"),a("#tmsm-availpro-form-checkindateinfo").html(e.format("L")),a("#tmsm-availpro-form-checkindate").val(e.format("YYYY-MM-DD")),a("#tmsm-availpro-form-arrivaldate").val(e.format("YYYY-MM-DD")),(n=a(".calendar-day-"+e.format("YYYY-MM-DD")+" .cell").data("minstay"))||(n=0),a("#tmsm-availpro-form-minstay-message").attr("data-value",n),a("#tmsm-availpro-form-minstay-number").html(n)):!1===r&&(o=l,n>0&&moment(e).add(n,"days")>o&&(console.warn("doest not respect minstay"),o=void 0),void 0!==o&&a(".calendar-day-"+o.format("YYYY-MM-DD")).addClass("selected selected-end")),a("#tmsm-availpro-form-dates-container").hide(),void 0!==e&&void 0!==o?(d=o.diff(e,"days"),a("#tmsm-availpro-form-checkoutdateinfo").html(o.format("L")),a("#tmsm-availpro-form-checkoutdate").val(o.format("YYYY-MM-DD")),a("#tmsm-availpro-form-dates-container").show(),a("#tmsm-availpro-calculatetotal").submit()):d=0,a("#tmsm-availpro-form-nights-number").html(d),a("#tmsm-availpro-form-nights-message").attr("data-value",d),a("#tmsm-availpro-form-nights").val(d),d>0?(a("#tmsm-availpro-form-minstay-message").attr("data-value",0),a("#tmsm-availpro-form-minstay-number").html("")):(a("#tmsm-availpro-calculatetotal-totalprice").hide(),a("#tmsm-availpro-calculatetotal-ota").hide()))},onMonthChange:v},doneRendering:function(){var t=this;a(this.element).on("mouseover",".day:not(.inactive)",function(l){var r=t.buildTargetObject(l.currentTarget,!0),s=e,m=r.date;if(void 0!==e&&void 0===o){a(".day").removeClass("mouseover").removeClass("selected").removeClass("selected-hover").removeClass("selected-end"),a(".calendar-day-"+m.format("YYYY-MM-DD")).addClass("selected selected-end");var i=0,c=s;if(m>c)for(a(".calendar-day-"+c.format("YYYY-MM-DD")).addClass("selected selected-hover");m.format("YYYY-MM-DD")!=c.format("YYYY-MM-DD");)i++,c=moment(s).add(i,"days"),a(".calendar-day-"+c.format("YYYY-MM-DD")).addClass("selected selected-hover")}else a(".day.mouseover").removeClass("mouseover"),a(".calendar-day-"+m.format("YYYY-MM-DD")).addClass("mouseover")})}});v(i),a("#tmsm-availpro-calculatetotal").on("submit",function(t){t.preventDefault(),a("#tmsm-availpro-calculatetotal-totalprice-value").html(""),a("#tmsm-availpro-calculatetotal-ota").html(""),a("#tmsm-availpro-form-submit").prop("disabled",!0),a("#tmsm-availpro-calculatetotal-loading").show(),a("#tmsm-availpro-calculatetotal-errors").hide(),a("#tmsm-availpro-form").removeClass("tmsm-availpro-form-has-ota-price"),e&&d>0&&a.ajax({url:_wpUtilSettings.ajax.url,type:"post",dataType:"json",enctype:"multipart/form-data",data:{action:"tmsm-availpro-calculatetotal",date_begin:e.format("YYYY-MM-DD"),date_end:o.format("YYYY-MM-DD"),nights:d,security:a("#tmsm-availpro-calculatetotal-nonce").val()},success:function(t){if(a("#tmsm-availpro-calculatetotal-loading").hide(),!0===t.success){if(a("#tmsm-availpro-form-submit").prop("disabled",!1),a("#tmsm-availpro-calculatetotal-errors").hide(),t.data.accommodation&&t.data.accommodation.totalprice){var e=t.data.accommodation.totalprice;if(e){a("#tmsm-availpro-calculatetotal-totalprice").show();var o=e;o&&a("#tmsm-availpro-calculatetotal-totalprice").html(_.unescape(tmsm_availpro_params.i18n.selecteddatepricelabel.replace(/%/g,o)))}}if(t.data.ota&&t.data.ota.totalprice){var e=t.data.ota.totalprice;if(e){a("#tmsm-availpro-form").addClass("tmsm-availpro-form-has-ota-price"),a("#tmsm-availpro-calculatetotal-ota").show();var o=e;o&&a("#tmsm-availpro-calculatetotal-ota").html("."+_.unescape(tmsm_availpro_params.i18n.otacomparelabel.replace(/%/g,o)))}else a("#tmsm-availpro-form").removeClass("tmsm-availpro-form-has-ota-price")}}else a("#tmsm-availpro-form-submit").prop("disabled",!0),a("#tmsm-availpro-calculatetotal-totalprice").hide(),a("#tmsm-availpro-calculatetotal-ota").hide(),a("#tmsm-availpro-calculatetotal-errors").show().html(t.errors),a("#tmsm-availpro-form").removeClass("tmsm-availpro-form-has-ota-price")},error:function(a,t){console.log("error"),console.log(a),console.log(t)}})})}},a(document).ready(function(){t.init()}),a(document).on("elementor/popup/show",(a,e,o)=>{t.init()});var e=a(".tmsm-availpro-bestprice-year");e.length>0&&e.each(function(t){a(this).data("price")&&a(this).html(_.unescape(tmsm_availpro_params.i18n.yearbestpricelabel.replace("%",Number(a(this).data("price")).toLocaleString(tmsm_availpro_params.locale,{style:"currency",currency:tmsm_availpro_params.options.currency,minimumFractionDigits:0,maximumFractionDigits:0}))))})}(jQuery,TmsmAvailproApp);